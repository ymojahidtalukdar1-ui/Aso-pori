<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶è‡¶∏‡ßã ‡¶™‡¶°‡¶º‡¶ø - ‡¶™‡¶°‡¶º‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kalpurush', 'Segoe UI', sans-serif;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #38a169;
            --danger: #e53e3e;
            --warning: #dd6b20;
            --light: #f7fafc;
            --dark: #2d3748;
        }

        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* Authentication Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 500px;
            padding: 40px 30px;
            position: relative;
        }

        .admin-login-corner {
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .admin-settings-btn {
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
            transition: transform 0.3s ease;
        }

        .admin-settings-btn:hover {
            transform: rotate(90deg);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 5px;
        }

        .logo p {
            color: #718096;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            margin-bottom: 25px;
            background: #f7fafc;
            border-radius: 10px;
            padding: 5px;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        textarea {
            height: 100px;
            resize: vertical;
        }

        .phone-input {
            display: flex;
            align-items: center;
        }

        .country-code {
            background: #f7fafc;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-right: none;
            border-radius: 10px 0 0 10px;
            font-weight: 600;
            color: var(--primary);
        }

        .phone-input input {
            border-radius: 0 10px 10px 0;
        }

        button {
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .btn-full {
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #4a5568;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-success {
            background: var(--success);
        }

        .btn-warning {
            background: var(--warning);
        }

        .message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            display: none;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
        }

        /* App Styles */
        .app-container {
            display: none;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            cursor: pointer;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: auto;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: none;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Dashboard Styles */
        .welcome-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .welcome-card h2 {
            color: #4a5568;
            margin-bottom: 10px;
        }

        .date-display {
            color: #718096;
            font-size: 18px;
            margin-bottom: 20px;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .action-icon {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        /* Search Bar Styles */
        .search-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .search-input {
            flex: 1;
        }
        
        .class-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            display: none;
        }
        
        .class-filter {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 20px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .class-filter:hover {
            background: #edf2f7;
        }
        
        .class-filter.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .toggle-class-filters {
            text-align: center;
            margin-top: 10px;
        }

        .toggle-class-filters button {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            width: auto;
            padding: 8px 16px;
        }

        /* Add Study Material Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
        }

        /* File Upload Styles */
        .file-upload-container {
            margin-top: 10px;
        }

        .file-upload-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .file-upload-input input {
            flex: 1;
        }

        .file-preview {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .file-preview-item {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }

        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .file-preview-item .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Study Materials List */
        .study-materials {
            display: grid;
            gap: 20px;
        }

        .material-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
            position: relative;
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .material-title {
            font-size: 20px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .material-class {
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .material-date {
            color: #718096;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .material-author {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #718096;
            font-size: 14px;
            font-style: italic;
        }

        .author-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .material-content {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .material-images {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .material-image {
            width: 100%;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .material-image:hover {
            transform: scale(1.05);
        }

        .homework {
            background: #fffaf0;
            border: 1px solid #fed7aa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .homework h4 {
            color: var(--warning);
            margin-bottom: 8px;
        }

        .material-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .delete-btn {
            background: var(--danger);
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .edit-btn {
            background: var(--warning);
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        .no-materials {
            text-align: center;
            padding: 50px 20px;
            color: #718096;
        }

        .no-materials h3 {
            margin-bottom: 10px;
        }

        /* Admin Only Styles */
        .admin-only {
            border: 2px solid var(--danger);
        }

        .admin-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--danger);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Admin Panel Styles */
        .admin-panel {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admin-panel h3 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .admin-panel h4 {
            color: var(--dark);
            margin-top: 20px;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .admin-control-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .admin-control-card h4 {
            margin-bottom: 10px;
            color: var(--dark);
        }

        .admin-control-card p {
            color: #718096;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .admin-class-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        .admin-class-card {
            background: var(--primary);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .admin-class-card:hover {
            background: var(--secondary);
            transform: translateY(-3px);
        }

        .stat-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #718096;
        }

        /* User Profile Styles */
        .profile-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: none;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            cursor: pointer;
        }

        .profile-info h3 {
            color: var(--dark);
            margin-bottom: 5px;
        }

        .profile-info p {
            color: #718096;
        }

        /* Users List Styles */
        .users-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .user-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 15px;
            border: 3px solid var(--primary);
            cursor: pointer;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        /* Admin Setup Styles */
        .admin-setup {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .admin-setup h3 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        /* Profile Update Section */
        .profile-update-section {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 2px dashed #cbd5e0;
        }

        .profile-update-section h4 {
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }
        
        .avatar-upload-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        #profile-avatar-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #718096;
        }

        .empty-state h3 {
            margin-bottom: 10px;
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
        }

        .image-modal-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .auth-box {
                padding: 30px 20px;
            }
            
            .material-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .material-actions {
                flex-direction: column;
            }
            
            .admin-controls {
                grid-template-columns: 1fr;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .users-list {
                grid-template-columns: 1fr;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .class-filters {
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Section -->
    <div class="auth-container" id="auth-container">
        <div class="auth-box">
            <div class="admin-login-corner">
                <button class="admin-settings-btn" onclick="handleAdminLogin()">‚öôÔ∏è</button>
            </div>

            <div class="logo">
                <h1>‡¶è‡¶∏‡ßã ‡¶™‡¶°‡¶º‡¶ø</h1>
                <p>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¶‡¶ø‡¶®‡ßá‡¶∞ ‡¶™‡¶°‡¶º‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞‡¶ø‡¶Ç ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶ü‡¶´‡¶∞‡ßç‡¶Æ</p>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="login">‡¶≤‡¶ó‡¶á‡¶®</div>
                <div class="tab" data-tab="signup">‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™</div>
            </div>

            <!-- Login Form -->
            <div class="form-container active" id="login-form">
                <!-- START OF CHANGE: Phone input replaced with email input -->
                <div class="form-group">
                    <label for="login-email">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                    <input type="email" id="login-email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®">
                </div>
                <!-- END OF CHANGE -->
                <div class="form-group">
                    <label for="login-password">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="login-password" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®">
                </div>
                <button class="btn-full" id="login-btn">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <div class="message" id="login-message"></div>
            </div>

            <!-- Sign Up Form -->
            <div class="form-container" id="signup-form">
                <div class="form-group">
                    <label for="signup-name">‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="signup-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®">
                </div>
                <!-- START OF CHANGE: Phone input replaced with email input -->
                <div class="form-group">
                    <label for="signup-email">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                    <input type="email" id="signup-email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®">
                </div>
                <!-- END OF CHANGE -->
                <div class="form-group">
                    <label for="signup-password">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="signup-password" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®">
                </div>
                <div class="form-group">
                    <label for="signup-class">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏</label>
                    <select id="signup-class"></select>
                </div>
                <button class="btn-full" id="signup-btn">‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <div class="message" id="signup-message"></div>
            </div>
        </div>
    </div>

    <!-- User App Section -->
    <div class="app-container" id="user-app">
        <div class="header">
            <div class="nav">
                <div class="logo">
                    <h1>‡¶è‡¶∏‡ßã ‡¶™‡¶°‡¶º‡¶ø</h1>
                </div>
                <div class="user-info">
                    <img id="user-avatar" src="" alt="User Avatar" class="user-avatar" onerror="this.src='https://via.placeholder.com/40'">
                    <span id="user-name">‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü</span>
                    <button class="logout-btn" id="refresh-btn" title="‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®">üîÑ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂</button>
                    <button class="logout-btn" id="user-logout-btn">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="search-input" class="search-input" placeholder="‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º ‡¶¨‡¶æ ‡¶ü‡¶™‡¶ø‡¶ï ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®...">
                    <button id="search-btn" style="width: auto; padding: 12px 20px;">‡¶∏‡¶æ‡¶∞‡ßç‡¶ö</button>
                </div>
                <div class="toggle-class-filters">
                    <button id="toggle-class-btn">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                </div>
                <div class="class-filters" id="class-filters"></div>
            </div>

            <div class="welcome-card">
                <h2 id="welcome-text">‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!</h2>
                <div class="date-display" id="current-date"></div>
            </div>

            <div class="quick-actions">
                <div class="action-card" onclick="openShareModal()">
                    <div class="action-icon">üìö</div>
                    <h3>‡¶™‡¶°‡¶º‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                </div>
                <div class="action-card" onclick="toggleProfileSection()">
                    <div class="action-icon">üë§</div>
                    <h3>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</h3>
                </div>
                <div class="action-card" onclick="viewAllMaterials()">
                    <div class="action-icon">üìñ</div>
                    <h3>‡¶∏‡¶ï‡¶≤ ‡¶™‡¶°‡¶º‡¶æ</h3>
                </div>
            </div>

            <div class="admin-panel" id="admin-panel" style="display: none;">
                <h3>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</h3>
                <div class="admin-stats" id="admin-stats"></div>
                <div class="admin-controls">
                    <div class="admin-control-card">
                        <h4>‡¶∏‡¶ï‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</h4>
                        <p>‡¶∏‡¶¨‡¶æ‡¶á‡¶ï‡ßá ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶ì ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                        <button class="btn-full" onclick="showAllUsers()">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                    </div>
                    <div class="admin-control-card">
                        <h4>‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
                        <p>‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</p>
                        <button class="btn-full" onclick="openAdminSettingsModal()">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ñ‡ßÅ‡¶≤‡ßÅ‡¶®</button>
                    </div>
                </div>
                <h4>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h4>
                <div class="admin-class-list" id="admin-class-list"></div>
            </div>

            <div class="profile-section" id="profile-section">
                <div class="profile-header">
                    <img id="profile-avatar" src="" alt="Profile Avatar" class="profile-avatar" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="profile-info">
                        <h3 id="profile-name">‡¶®‡¶æ‡¶Æ</h3>
                        <p id="profile-class">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏</p>
                        <!-- START OF CHANGE: Phone display replaced with email display -->
                        <p id="profile-email">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</p>
                        <!-- END OF CHANGE -->
                    </div>
                </div>
                <div class="profile-update-section" id="profile-update-section" style="display: none;">
                    <h4>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h4>
                    <div class="form-group">
                        <label>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶õ‡¶¨‡¶ø</label>
                        <div class="avatar-upload-group">
                            <img id="profile-avatar-preview" src="https://via.placeholder.com/80" alt="Avatar Preview">
                            <input type="file" id="profile-avatar-upload" accept="image/*" style="display: none;">
                            <button type="button" class="btn-full" onclick="document.getElementById('profile-avatar-upload').click()">‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="profile-class-select">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</label>
                        <select id="profile-class-select"></select>
                    </div>
                    <div class="form-group">
                        <label for="new-password">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                        <input type="password" id="new-password" placeholder="‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶¨‡ßá ‡¶®‡¶æ">
                    </div>
                    <button class="btn-success" id="update-profile-btn">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                    <div class="message" id="profile-message"></div>
                </div>
                <button class="btn-full" onclick="toggleProfileUpdate()" id="toggle-profile-btn">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>

            <div class="users-list" id="users-list" style="display: none;"></div>
            <div class="study-materials" id="study-materials"></div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="share-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeShareModal()">&times;</span>
            <h3 style="text-align: center; color: var(--primary); margin-bottom: 20px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶°‡¶º‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <form id="add-material-form">
                <div class="form-group"><label for="material-subject">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º *</label><input type="text" id="material-subject" required></div>
                <div class="form-group"><label for="material-topic">‡¶ü‡¶™‡¶ø‡¶ï *</label><input type="text" id="material-topic" required></div>
                <div class="form-group"><label for="material-description">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ *</label><textarea id="material-description" required></textarea></div>
                <div class="form-group"><label for="material-homework">‡¶¨‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶ú</label><textarea id="material-homework"></textarea></div>
                <div class="form-group">
                    <label>‡¶õ‡¶¨‡¶ø</label>
                    <input type="file" id="file-upload" accept="image/*" multiple style="display: none;">
                    <button type="button" class="btn-full" onclick="document.getElementById('file-upload').click()">‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                    <div class="file-preview" id="file-preview"></div>
                </div>
                <button type="submit" class="btn-full">üìö ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div class="message" id="material-message"></div>
        </div>
    </div>

    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeEditModal()">&times;</span>
            <h3 style="text-align: center; color: var(--primary); margin-bottom: 20px;">‡¶™‡¶°‡¶º‡¶æ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <form id="edit-material-form">
                <input type="hidden" id="edit-material-id">
                <div class="form-group"><label for="edit-material-subject">‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º *</label><input type="text" id="edit-material-subject" required></div>
                <div class="form-group"><label for="edit-material-topic">‡¶ü‡¶™‡¶ø‡¶ï *</label><input type="text" id="edit-material-topic" required></div>
                <div class="form-group"><label for="edit-material-description">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ *</label><textarea id="edit-material-description" required></textarea></div>
                <div class="form-group"><label for="edit-material-homework">‡¶¨‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶ú</label><textarea id="edit-material-homework"></textarea></div>
                <div class="form-group">
                    <label>‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶õ‡¶¨‡¶ø</label>
                    <div class="file-preview" id="edit-existing-files-preview"></div>
                    <label>‡¶®‡¶§‡ßÅ‡¶® ‡¶õ‡¶¨‡¶ø ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <input type="file" id="edit-file-upload" accept="image/*" multiple style="display: none;">
                    <button type="button" class="btn-full" onclick="document.getElementById('edit-file-upload').click()">‡¶®‡¶§‡ßÅ‡¶® ‡¶õ‡¶¨‡¶ø</button>
                    <div class="file-preview" id="edit-file-preview"></div>
                </div>
                <button type="submit" class="btn-success">üíæ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div class="message" id="edit-message"></div>
        </div>
    </div>

    <!-- NEW: Admin Settings Modal -->
    <div class="modal" id="admin-settings-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdminSettingsModal()">&times;</span>
            <h3 style="text-align: center; color: var(--primary); margin-bottom: 20px;">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h3>
            <form id="admin-settings-form">
                <div class="form-group">
                    <label for="admin-new-username">‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ</label>
                    <input type="text" id="admin-new-username" placeholder="‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶¨‡ßá ‡¶®‡¶æ">
                </div>
                <hr style="margin-bottom: 20px; border: 1px solid #f0f0f0;">
                <div class="form-group">
                    <label for="admin-current-password">‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° (‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï)</label>
                    <input type="password" id="admin-current-password" required placeholder="‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï">
                </div>
                <div class="form-group">
                    <label for="admin-new-password">‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="admin-new-password" placeholder="‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶ñ‡¶≤‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶¨‡ßá ‡¶®‡¶æ">
                </div>
                <button type="submit" class="btn-success">üíæ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <div class="message" id="admin-settings-message"></div>
        </div>
    </div>

    <div class="image-modal" id="image-modal" onclick="this.style.display='none'">
        <div class="image-modal-content"><img id="modal-image" src="" alt="Full Screen Image"></div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyAjQvMtvi-WlKKwL7BglwBT6OG6VgEywFY",
            authDomain: "aso-pori-app-4f9dc.firebaseapp.com",
            projectId: "aso-pori-app-4f9dc",
            storageBucket: "aso-pori-app-4f9dc.appspot.com",
            messagingSenderId: "1093409142483",
            appId: "1:1093409142483:web:5a4ae53769301056188626",
            measurementId: "G-QEVSFWXQF3"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ==================== GLOBAL VARIABLES & CONSTANTS ====================
        let currentSearchQuery = '';
        let currentFilterClass = 'all';
        let uploadFiles = [];
        let editUploadFiles = [];
        let newAvatarFile = null;
        const CLASS_OPTIONS = {
            '6': '‡¶∑‡¶∑‡ßç‡¶† ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ', '7': '‡¶∏‡¶™‡ßç‡¶§‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ', '8': '‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ',
            '9': '‡¶®‡¶¨‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ', '10': '‡¶¶‡¶∂‡¶Æ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ', 'ssc': '‡¶è‡¶∏‡¶è‡¶∏‡¶∏‡¶ø ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ',
            '11': '‡¶è‡¶ï‡¶æ‡¶¶‡¶∂ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ', '12': '‡¶¶‡ßç‡¶¨‡¶æ‡¶¶‡¶∂ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ'
        };

        // ==================== DOM ELEMENTS ====================
        const authContainer = document.getElementById('auth-container');
        const userAppContainer = document.getElementById('user-app');

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            // This function checks for internet connection as requested.
            checkInternetConnection();
            updateDate();
            setupEventListeners();
            populateClassDropdowns();
            auth.onAuthStateChanged(handleAuthStateChange);
        });
        
        // ==================== INTERNET CONNECTION CHECK ====================
        // This function fulfills the requirement of checking for an internet connection.
        function checkInternetConnection() {
            if (!navigator.onLine) {
                alert("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                document.body.innerHTML = '<h1 style="text-align: center; margin-top: 50px; color: white;">‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á</h1>';
            }
        }

        // ==================== EVENT LISTENERS SETUP ====================
        function setupEventListeners() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    document.querySelectorAll('.tab, .form-container').forEach(el => el.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tabName}-form`).classList.add('active');
                });
            });
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('signup-btn').addEventListener('click', handleSignup);
            document.getElementById('user-logout-btn').addEventListener('click', handleLogout);
            
            document.getElementById('refresh-btn').addEventListener('click', () => {
                location.reload();
            });

            document.getElementById('search-btn').addEventListener('click', () => {
                currentSearchQuery = document.getElementById('search-input').value;
                loadStudyMaterials();
            });
            document.getElementById('toggle-class-btn').addEventListener('click', toggleClassFilters);
            document.getElementById('add-material-form').addEventListener('submit', addStudyMaterial);
            document.getElementById('edit-material-form').addEventListener('submit', updateStudyMaterial);
            document.getElementById('update-profile-btn').addEventListener('click', updateProfile);
            document.getElementById('file-upload').addEventListener('change', (e) => handleFileUpload(e, 'file-preview', 'upload'));
            document.getElementById('edit-file-upload').addEventListener('change', (e) => handleFileUpload(e, 'edit-file-preview', 'edit'));
            document.getElementById('profile-avatar-upload').addEventListener('change', handleAvatarUpload);
            document.getElementById('admin-settings-form').addEventListener('submit', updateAdminCredentials);
        }

        // ==================== AUTHENTICATION ====================
        async function handleAuthStateChange(user) {
            if (user) {
                const adminCredsDoc = await db.collection('admin_credentials').doc('credentials').get();
                if (adminCredsDoc.exists && adminCredsDoc.data().email === user.email) {
                    const adminData = { uid: user.uid, email: user.email, name: "‡¶è‡¶°‡¶Æ‡¶ø‡¶®", type: "admin" };
                    sessionStorage.setItem('currentUser', JSON.stringify(adminData));
                    showUserApp(adminData);
                } else {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        const userData = { uid: user.uid, ...userDoc.data() };
                        sessionStorage.setItem('currentUser', JSON.stringify(userData));
                        showUserApp(userData);
                    }
                }
            } else {
                sessionStorage.removeItem('currentUser');
                showAuth();
            }
        }

        // START OF CHANGE: Updated handleLogin function to use email
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            if (!email || !password) return showMessage('login-message', '‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®', 'error');
            
            auth.signInWithEmailAndPassword(email, password)
                .catch(err => showMessage('login-message', '‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°', 'error'));
        }
        // END OF CHANGE

        // START OF CHANGE: Updated handleSignup function to use email
        function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const classValue = document.getElementById('signup-class').value;

            if (!name || !email || !password || !classValue) return showMessage('signup-message', '‡¶∏‡¶¨ ‡¶ò‡¶∞ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');

            auth.createUserWithEmailAndPassword(email, password)
                .then(cred => db.collection('users').doc(cred.user.uid).set({
                    name, email: email, class: classValue, type: 'student', avatar: ''
                }))
                .then(() => {
                    showMessage('signup-message', '‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶è‡¶ñ‡¶® ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'success');
                    document.querySelector('.tab[data-tab="login"]').click();
                    document.getElementById('login-email').value = email;
                })
                .catch(err => showMessage('signup-message', err.code === 'auth/email-already-in-use' ? '‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá‡•§' : '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§', 'error'));
        }
        // END OF CHANGE

        async function handleAdminLogin() {
            const email = prompt("‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤:");
            if (!email) return;
            const password = prompt("‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:");
            if (!password) return;

            try {
                const doc = await db.collection('admin_credentials').doc('credentials').get();
                if (!doc.exists || doc.data().email !== email) {
                    return alert("‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶° ‡¶®‡ßü‡•§");
                }
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡•§");
                } else {
                    alert("‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
                }
            }
        }

        function handleLogout() { auth.signOut(); }

        // ==================== UI & DISPLAY LOGIC ====================
        function showAuth() {
            authContainer.style.display = 'flex';
            userAppContainer.style.display = 'none';
        }

        function showUserApp(userData) {
            authContainer.style.display = 'none';
            userAppContainer.style.display = 'block';

            document.getElementById('user-name').textContent = `${userData.name}${userData.type === 'admin' ? ' (‡¶è‡¶°‡¶Æ‡¶ø‡¶®)' : ''}`;
            const avatarUrl = userData.avatar || 'https://via.placeholder.com/40';
            const userAvatar = document.getElementById('user-avatar');
            userAvatar.src = avatarUrl;
            userAvatar.onclick = () => openImageModal(avatarUrl);

            document.getElementById('welcome-text').textContent = `${userData.name}, ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ!`;
            
            const isAdmin = userData.type === 'admin';
            document.getElementById('admin-panel').style.display = isAdmin ? 'block' : 'none';
            if (isAdmin) loadAdminDashboard();
            
            loadStudyMaterials();
            populateClassFilters();
        }

        function displayStudyMaterials(materials) {
            const container = document.getElementById('study-materials');
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || '{}');
            if (materials.length === 0) {
                container.innerHTML = `<div class="empty-state"><h3>‡¶ï‡ßã‡¶® ‡¶™‡¶°‡¶º‡¶æ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h3><p>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶°‡¶º‡¶æ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®!</p></div>`;
                return;
            }
            container.innerHTML = materials.map(m => {
                const isAuthor = m.authorUid === currentUser.uid;
                const isAdmin = currentUser.type === 'admin';
                return `
                <div class="material-card">
                    <div class="material-header">
                        <div>
                            <h3 class="material-title">${m.subject} - ${m.topic}</h3>
                            <div class="material-date">${m.createdAt ? formatDate(m.createdAt.toDate()) : ''}</div>
                            <div class="material-author"><img src="${m.authorAvatar || 'https://via.placeholder.com/30'}" class="author-avatar">${m.author}</div>
                        </div>
                        <div class="material-class">${CLASS_OPTIONS[m.class] || ''}</div>
                    </div>
                    <div class="material-content"><p>${m.description.replace(/\n/g, '<br>')}</p></div>
                    ${(m.imageUrls && m.imageUrls.length) ? `<div class="material-images">${m.imageUrls.map(url => `<img src="${url}" class="material-image" onclick="openImageModal('${url}')">`).join('')}</div>` : ''}
                    ${m.homework ? `<div class="homework"><h4>üè† ‡¶¨‡¶æ‡¶°‡¶º‡¶ø‡¶∞ ‡¶ï‡¶æ‡¶ú</h4><p>${m.homework.replace(/\n/g, '<br>')}</p></div>` : ''}
                    ${(isAdmin || isAuthor) ? `<div class="material-actions">
                        ${isAuthor ? `<button class="edit-btn" onclick="openEditModal('${m.id}')">‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü</button>` : ''}
                        ${isAdmin ? `<button class="delete-btn" onclick="deleteMaterial('${m.id}')">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>` : ''}
                    </div>` : ''}
                </div>`;
            }).join('');
        }
        
        // START OF CHANGE: Updated displayUsers to show email instead of phone
        function displayUsers(users) {
            const container = document.getElementById('users-list');
            container.innerHTML = users.length ? users.map(user => {
                const avatarUrl = user.avatar || 'https://via.placeholder.com/80';
                return `
                <div class="user-card">
                    <img src="${avatarUrl}" class="user-avatar-large" onclick="openImageModal('${avatarUrl}')">
                    <h3>${user.name}</h3>
                    <p>${CLASS_OPTIONS[user.class]}</p>
                    <p>${user.email}</p> 
                    <div class="user-actions"><button class="btn-danger" onclick="deleteUser('${user.uid}', '${user.name}')">‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button></div>
                </div>`
            }).join('') : '<p>‡¶ï‡ßã‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶®‡ßá‡¶á‡•§</p>';
            container.style.display = 'grid';
        }
        // END OF CHANGE

        // ==================== DATA HANDLING ====================
        async function loadStudyMaterials() {
            try {
                let query = db.collection('studyMaterials').orderBy('createdAt', 'desc');
                if (currentFilterClass !== 'all') query = query.where('class', '==', currentFilterClass);
                const snapshot = await query.get();
                let materials = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                if (currentSearchQuery.trim()) {
                    const q = currentSearchQuery.toLowerCase();
                    materials = materials.filter(m => ['subject', 'topic', 'description'].some(field => m[field] && m[field].toLowerCase().includes(q)));
                }
                displayStudyMaterials(materials);
            } catch (error) { console.error("Error loading materials:", error); }
        }
        
        async function addStudyMaterial(e) {
            e.preventDefault();
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            showMessage('material-message', '‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'success');
            const imageUrls = await uploadFilesToStorage(uploadFiles, 'study-materials');
            await db.collection('studyMaterials').add({
                subject: document.getElementById('material-subject').value,
                topic: document.getElementById('material-topic').value,
                description: document.getElementById('material-description').value,
                homework: document.getElementById('material-homework').value,
                imageUrls,
                author: currentUser.name,
                authorUid: currentUser.uid,
                authorAvatar: currentUser.avatar || '',
                class: currentUser.class,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            closeShareModal();
            loadStudyMaterials();
        }
        
        async function updateStudyMaterial(e) {
            e.preventDefault();
            const id = document.getElementById('edit-material-id').value;
            showMessage('edit-message', '‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'success');
            const existingImages = Array.from(document.querySelectorAll('#edit-existing-files-preview .file-preview-item img')).map(img => img.src);
            const newImageUrls = await uploadFilesToStorage(editUploadFiles, 'study-materials');
            await db.collection('studyMaterials').doc(id).update({
                subject: document.getElementById('edit-material-subject').value,
                topic: document.getElementById('edit-material-topic').value,
                description: document.getElementById('edit-material-description').value,
                homework: document.getElementById('edit-material-homework').value,
                imageUrls: [...existingImages, ...newImageUrls]
            });
            closeEditModal();
            loadStudyMaterials();
        }

        async function deleteMaterial(id) {
            if (confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶è‡¶á ‡¶™‡¶°‡¶º‡¶æ‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')) {
                await db.collection('studyMaterials').doc(id).delete();
                loadStudyMaterials();
            }
        }

        async function updateProfile() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            const userRef = db.collection('users').doc(currentUser.uid);
            showMessage('profile-message', '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'success');
            let updatedData = { class: document.getElementById('profile-class-select').value };
            if (newAvatarFile) {
                const avatarUrl = await uploadFilesToStorage([newAvatarFile], `avatars/${currentUser.uid}`);
                updatedData.avatar = avatarUrl[0];
            }
            await userRef.update(updatedData);
            const newPassword = document.getElementById('new-password').value;
            if (newPassword) {
                try { await auth.currentUser.updatePassword(newPassword); }
                catch (error) { return showMessage('profile-message', '‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error'); }
            }
            const updatedUserDoc = await userRef.get();
            const newUserData = { uid: currentUser.uid, ...updatedUserDoc.data() };
            sessionStorage.setItem('currentUser', JSON.stringify(newUserData));
            showUserApp(newUserData);
            loadProfileData();
            showMessage('profile-message', '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
        }

        // ==================== ADMIN FUNCTIONS ====================
        async function loadAdminDashboard() {
            const users = await db.collection('users').get();
            const materials = await db.collection('studyMaterials').get();
            document.getElementById('admin-stats').innerHTML = `
                <div class="stat-card"><div class="stat-number">${users.size}</div><div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</div></div>
                <div class="stat-card"><div class="stat-number">${materials.size}</div><div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶™‡¶°‡¶º‡¶æ</div></div>`;
            const classes = [...new Set(users.docs.map(doc => doc.data().class))];
            document.getElementById('admin-class-list').innerHTML = classes.sort().map(c => `
                <div class="admin-class-card" onclick="showUsersByClass('${c}')">${CLASS_OPTIONS[c]}</div>`).join('');
        }
        
        async function showAllUsers() {
            const snapshot = await db.collection('users').get();
            displayUsers(snapshot.docs.map(doc => ({ uid: doc.id, ...doc.data() })));
        }
        
        async function showUsersByClass(classValue) {
            const snapshot = await db.collection('users').where('class', '==', classValue).get();
            displayUsers(snapshot.docs.map(doc => ({ uid: doc.id, ...doc.data() })));
        }
        
        async function deleteUser(uid, name) {
            if (confirm(`${name}-‡¶ï‡ßá ‡¶ï‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?`)) {
                await db.collection('users').doc(uid).delete();
                alert('‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§');
                showAllUsers();
                loadAdminDashboard();
            }
        }
        
        async function updateAdminCredentials(e) {
            e.preventDefault();
            const currentPassword = document.getElementById('admin-current-password').value;
            const newUsername = document.getElementById('admin-new-username').value.trim();
            const newPassword = document.getElementById('admin-new-password').value;
            
            if (!currentPassword) {
                return showMessage('admin-settings-message', '‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§', 'error');
            }
            if (!newUsername && !newPassword) {
                return showMessage('admin-settings-message', '‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶®‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®‡•§', 'warning');
            }

            showMessage('admin-settings-message', '‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'success');
            const user = auth.currentUser;
            const credential = firebase.auth.EmailAuthProvider.credential(user.email, currentPassword);
            
            try {
                await user.reauthenticateWithCredential(credential);
                
                if (newUsername) {
                    await db.collection('admin_credentials').doc('credentials').update({ username: newUsername });
                }
                
                if (newPassword) {
                    await user.updatePassword(newPassword);
                }
                
                showMessage('admin-settings-message', '‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
                setTimeout(closeAdminSettingsModal, 2000);

            } catch (error) {
                if (error.code === 'auth/wrong-password') {
                    showMessage('admin-settings-message', '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡¶ü‡¶ø ‡¶≠‡ßÅ‡¶≤‡•§', 'error');
                } else {
                    showMessage('admin-settings-message', '‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                }
            }
        }


        // ==================== UTILITY & HELPER FUNCTIONS ====================
        function formatDate(date) { return new Date(date).toLocaleDateString('bn-BD', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }); }
        function populateClassDropdowns() {
            const options = Object.entries(CLASS_OPTIONS).map(([val, text]) => `<option value="${val}">${text}</option>`).join('');
            document.getElementById('signup-class').innerHTML = `<option value="">‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>${options}`;
            document.getElementById('profile-class-select').innerHTML = options;
        }
        function populateClassFilters() {
            const filters = Object.entries(CLASS_OPTIONS).map(([val, text]) => `<div class="class-filter" data-class="${val}">${text}</div>`).join('');
            document.getElementById('class-filters').innerHTML = `<div class="class-filter active" data-class="all">‡¶∏‡¶ï‡¶≤ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ</div>${filters}`;
            document.querySelectorAll('.class-filter').forEach(filter => {
                filter.addEventListener('click', () => {
                    document.querySelector('.class-filter.active').classList.remove('active');
                    filter.classList.add('active');
                    currentFilterClass = filter.getAttribute('data-class');
                    loadStudyMaterials();
                });
            });
        }
        function handleFileUpload(event, previewId, type) {
            const files = Array.from(event.target.files);
            if (type === 'upload') uploadFiles = files; else if (type === 'edit') editUploadFiles = files;
            const previewContainer = document.getElementById(previewId);
            previewContainer.innerHTML = '';
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = e => { previewContainer.innerHTML += `<div class="file-preview-item"><img src="${e.target.result}"></div>`; };
                reader.readAsDataURL(file);
            });
        }
        function handleAvatarUpload(event) {
            newAvatarFile = event.target.files[0];
            if (newAvatarFile) {
                const reader = new FileReader();
                reader.onload = e => document.getElementById('profile-avatar-preview').src = e.target.result;
                reader.readAsDataURL(newAvatarFile);
            }
        }
        async function uploadFilesToStorage(files, path) {
            if (!files || files.length === 0) return [];
            const promises = files.map(file => storage.ref(`${path}/${Date.now()}-${file.name}`).put(file).then(snap => snap.ref.getDownloadURL()));
            return Promise.all(promises);
        }
        function showMessage(elementId, message, type) {
            const el = document.getElementById(elementId);
            el.className = `message ${type}`;
            el.textContent = message;
            el.style.display = 'block';
            if (type !== 'success') {
                setTimeout(() => { if (el.textContent === message) el.style.display = 'none'; }, 5000);
            }
        }
        function updateDate() { document.getElementById('current-date').textContent = new Date().toLocaleDateString('bn-BD', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });}

        // ==================== MODAL & UI TOGGLES ====================
        function openShareModal() { document.getElementById('share-modal').style.display = 'flex'; }
        function closeShareModal() {
            document.getElementById('share-modal').style.display = 'none';
            document.getElementById('add-material-form').reset();
            document.getElementById('file-preview').innerHTML = '';
            uploadFiles = [];
        }
        async function openEditModal(id) {
            const doc = await db.collection('studyMaterials').doc(id).get();
            if (!doc.exists) return;
            const m = doc.data();
            document.getElementById('edit-material-id').value = id;
            document.getElementById('edit-material-subject').value = m.subject;
            document.getElementById('edit-material-topic').value = m.topic;
            document.getElementById('edit-material-description').value = m.description;
            document.getElementById('edit-material-homework').value = m.homework || '';
            document.getElementById('edit-existing-files-preview').innerHTML = (m.imageUrls || []).map(url => `
                <div class="file-preview-item"><img src="${url}"><button type="button" class="remove-file" onclick="this.parentElement.remove()">√ó</button></div>`).join('');
            document.getElementById('edit-modal').style.display = 'flex';
        }
        function closeEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            document.getElementById('edit-material-form').reset();
            document.getElementById('edit-existing-files-preview').innerHTML = '';
            document.getElementById('edit-file-preview').innerHTML = '';
            editUploadFiles = [];
        }
        function openAdminSettingsModal() { document.getElementById('admin-settings-modal').style.display = 'flex'; }
        function closeAdminSettingsModal() { 
            document.getElementById('admin-settings-modal').style.display = 'none';
            document.getElementById('admin-settings-form').reset();
            const msgEl = document.getElementById('admin-settings-message');
            msgEl.style.display = 'none';
            msgEl.textContent = '';
        }
        function openImageModal(url) {
            if (!url || url.includes('via.placeholder.com')) return;
            document.getElementById('modal-image').src = url;
            document.getElementById('image-modal').style.display = 'flex';
        }
        function toggleProfileSection() {
            const section = document.getElementById('profile-section');
            section.style.display = section.style.display === 'block' ? 'none' : 'block';
            if (section.style.display === 'block') loadProfileData();
        }
        function toggleProfileUpdate() {
            const section = document.getElementById('profile-update-section');
            const btn = document.getElementById('toggle-profile-btn');
            const isHidden = section.style.display === 'none';
            section.style.display = isHidden ? 'block' : 'none';
            btn.textContent = isHidden ? '‡¶´‡¶∞‡ßç‡¶Æ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®' : '‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
        }
        
        // START OF CHANGE: Updated loadProfileData to show email
        function loadProfileData() {
            const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
            if (!currentUser || currentUser.type === 'admin') {
                document.getElementById('profile-section').style.display = 'none';
                return;
            };
            document.getElementById('profile-name').textContent = currentUser.name;
            document.getElementById('profile-class').textContent = CLASS_OPTIONS[currentUser.class];
            document.getElementById('profile-email').textContent = currentUser.email;
            const avatarSrc = currentUser.avatar || 'https://via.placeholder.com/80';
            const profileAvatar = document.getElementById('profile-avatar');
            profileAvatar.src = avatarSrc;
            profileAvatar.onclick = () => openImageModal(avatarSrc);
            
            document.getElementById('profile-avatar-preview').src = avatarSrc;
            document.getElementById('profile-class-select').value = currentUser.class;
        }
        // END OF CHANGE

        function toggleClassFilters() {
            const filters = document.getElementById('class-filters');
            const btn = document.getElementById('toggle-class-btn');
            const isHidden = filters.style.display === 'none';
            filters.style.display = isHidden ? 'flex' : 'none';
            btn.textContent = isHidden ? '‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®' : '‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
        }
        function viewAllMaterials() { document.getElementById('study-materials').scrollIntoView({ behavior: 'smooth' }); }

        // Make functions globally accessible
        window.handleAdminLogin = handleAdminLogin;
        window.openShareModal = openShareModal;
        window.closeShareModal = closeShareModal;
        window.openEditModal = openEditModal;
        window.closeEditModal = closeEditModal;
        window.deleteMaterial = deleteMaterial;
        window.toggleProfileSection = toggleProfileSection;
        window.toggleProfileUpdate = toggleProfileUpdate;
        window.viewAllMaterials = viewAllMaterials;
        window.openImageModal = openImageModal;
        window.showAllUsers = showAllUsers;
        window.showUsersByClass = showUsersByClass;
        window.deleteUser = deleteUser;
        window.openAdminSettingsModal = openAdminSettingsModal;
        window.closeAdminSettingsModal = closeAdminSettingsModal;
    </script>
</body>
</html>